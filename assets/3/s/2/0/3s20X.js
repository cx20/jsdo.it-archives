// smart.js 0.8.6.130725a
//
// http://smartjs.net/
// (c) akira igarashi (UNIZONBEX)
// License : www.opensource.org/licenses/mit-license.php

(function(n){function q(a){"string"==typeof a?a=a.split(" "):"number"==typeof a&&(a=[a]);for(var b=a.length-1;-1<b;b--)""===a[b]?a.splace(b,0):"string"==typeof a[b]&&-1<a[b].indexOf("px")&&(a[b]=parseInt(a[b],10));return a}function r(a){for(var b=[],c=0;c<a.length;c++)b.push("number"==typeof a[c]?a[c]+"px":a[c]);return b.join(" ")}if(!n.smart){var d=n.smart={};if(function(){var a=document.createElement("canvas");return a&&"function"===typeof a.getContext}()){"function"!==typeof Object.defineProperty&&
(Object.defineProperty=function(a,b,c){"value"in c&&(a[b]=c.value);"get"in c&&a.__defineGetter__(b,c.get);"set"in c&&a.__defineSetter__(b,c.set);return a});"function"!==typeof Object.defineProperties&&(Object.defineProperties=function(a,b){for(var c in b)b.hasOwnProperty(c)&&Object.defineProperty(a,c,b[c]);return a});"function"!==typeof Object.create&&(Object.create=function(a,b){function c(){}c.prototype=a;var e=new c;null!=b&&Object.defineProperties(e,b);return e});"function"!==typeof Object.getPrototypeOf&&
(Object.getPrototypeOf=function(a){return a.__proto__});d.guid=0;d.defaultFont="";d.touchEnabled=function(){var a=document.createElement("div");a.setAttribute("ontouchstart","return");return"function"===typeof a.ontouchstart}();d.online="http"===location.href.substr(0,4);d.isAndroid40=/Android\s4\.0/.test(navigator.userAgent);d.isAndroid41=/Android\s4\.[1|2]/.test(navigator.userAgent);d.oldAndroid=/Android\s2\.[0|1]/.test(navigator.userAgent);var l=function(){var a=navigator.userAgent;return-1!=a.indexOf("Opera")?
"O":-1!=a.indexOf("MSIE")?"ms":-1!=a.indexOf("WebKit")?"webkit":"Gecko"==navigator.product?"Moz":""}();d.error=function(a){throw"smart.js error : "+a;};d.extend=function(a,b){1==arguments.length&&(b=a,a=Object);for(var c in b)b.hasOwnProperty(c)&&("function"===typeof b[c]?b[c]={value:b[c],writable:!0,enumerable:!0}:"enumerable"in b[c]||(b[c].enumerable=!0));var e=function(){e.prototype.init.apply(this,arguments)};e.prototype=Object.create(a.prototype,b);return e};var t="click mouseover mouseout mousedown mouseup mousemove touchstart touchmove touchend touchcancel gesturestart gesturechange gestureend".split(" "),
x=t.concat("enterframe change lastframe complete progress resize".split(" "));d.Binder=d.extend({init:function(){this.name="Binder";this._listable={};this._callbacks={};this._enabled=!0},enabled:{get:function(){return this._enabled},set:function(a){this._enabled=a}},bind:function(a,b){if(-1==x.indexOf(a))alert("smart.bind param error");else{var c=this._listable[a];if(null==c)this._listable[a]=[b];else if(-1==c.indexOf(b))c.push(b);else return;if(-1<t.indexOf(a)&&this.element&&!this._callbacks[a]){var e=
this,c=this._callbacks[a]=function(b){b.currentTarget==e.element&&(b.mouseX=void 0!=b.layerX?b.layerX:b.offsetX,b.mouseY=void 0!=b.layerY?b.layerY:b.offsetY,b.smartTarget=e,e.trigger(a,b))};this.element.addEventListener(a,c)}}},unbind:function(a,b){var c=this._listable[a];if(null!=c){var e=c.indexOf(b);-1!=e&&c.splice(e,1);0==c.length&&(c[a]=null,-1<t.indexOf(a)&&(this.element&&this._callbacks[a])&&(this.element.removeEventListener(a,this._callbacks[a]),this._callbacks[a]=null))}},trigger:function(a,
b){if(this._enabled){b||(b={});b.target=this;b.type=a;var c=this._listable[a];if(void 0!=c)for(var e=0,d=c.length;e<d;e++)null!=c[e]&&c[e].call(this,b)}}});d.Assets=d.extend(d.Binder,{init:function(){d.Binder.apply(this);this.name="Assets";this._count=this._total=0;this._data={};this._complete=null},load:function(a,b){"function"===typeof b&&(this._complete=b);for(var c in a)a.hasOwnProperty(c)&&(this._total++,this._load(c,a[c],function(a,b,c,d){this._data[a]=b;this._count++;this.trigger("progress");
this._count==this._total&&(this.trigger("complete"),"function"===typeof this._complete&&(a=this._complete,this._complete=null,a(this._data)))}))},total:{get:function(){return this._total}},count:{get:function(){return this._count}},data:{get:function(){return this._data}},_load:function(a,b,c){var e=new Image,d=this;e.onload=function(){c.call(d,a,e,b,!0)};e.onerror=function(){c.call(d,a,e,b,!1)};e.src=b}});d.View=d.extend(d.Binder,{init:function(){d.Binder.apply(this);this.name="View";this._id="";
this._parent=null;this._element=document.createElement("div");this._visible=!0;this._y=this._x=0;this._alpha=1;this._regY=this._regX=this._rotation=0;this._scaleY=this._scaleX=1;this._cursor="auto";this._z=0;this._border=this._bg=null},element:{get:function(){return this._element}},id:{get:function(){return this._id},set:function(a){this._id=a;this._element&&(this._element.id=a)}},bg:{get:function(){this._bg||(this._bg=new d.Background(this._element));return this._bg}},border:{get:function(){this._border||
(this._border=new d.Border(this._element));return this._border}},parent:{get:function(){return this._parent}},visible:{get:function(){return this._visible},set:function(a){this._element.style.display=(this._visible=a)?"block":"none"}},x:{get:function(){return this._x},set:function(a){this._x=a;this._transform()}},y:{get:function(){return this._y},set:function(a){this._y=a;this._transform()}},z:{get:function(){return this._z},set:function(a){this._element.style.zIndex=this._z=a}},alpha:{get:function(){return this._alpha},
set:function(a){this._element.style.opacity=this._alpha=a}},scale:{get:function(){return this._scaleX},set:function(a){this._scaleX=this._scaleY=a;this._transform()}},scaleX:{get:function(){return this._scaleX},set:function(a){this._scaleX=a;this._transform()}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY=a;this._transform()}},regX:{get:function(){return this._regX},set:function(a){this._regX=a;this._transOrigin()}},regY:{get:function(){return this._regY},set:function(a){this._regY=
a;this._transOrigin()}},rotation:{get:function(){return this._rotation},set:function(a){this._rotation=a;this._transform()}},matrix:{set:function(a){this._element.style[l+"Transform"]="matrix("+a.join(",")+")"}},_transReset:function(){this._element.style[l+"TransformOrigin"]="0 0";this._element.style[l+"Transform"]="translate(0,0) rotate(0) scale(1,1)"},_transOrigin:function(){this._element.style[l+"TransformOrigin"]=this._regX+"px "+this._regY+"px"},_transform:function(){this._element.style[l+"Transform"]=
"translate("+this._x+"px,"+this._y+"px) rotate("+this._rotation+"deg)scale("+this._scaleX+","+this._scaleY+")"},stage:{get:function(){for(var a=this;!a.isStage;)if(a.parent)a=a.parent;else return null;return a}},cursor:{get:function(){return this._cursor},set:function(a){a||(a="auto");this._element.style.cursor=this._cursor=a}},click:function(a){this.bind("click",a)},mouseover:function(a){this.bind("mouseover",a)},mouseout:function(a){this.bind("mouseout",a)},mousedown:function(a){this.bind("mousedown",
a)},mouseup:function(a){this.bind("mouseup",a)},mousemove:function(a){this.bind("mousemove",a)},touchstart:function(a){this.bind("touchstart",a)},touchmove:function(a){this.bind("touchmove",a)},touchend:function(a){this.bind("touchend",a)}});d.Box=d.extend(d.View,{init:function(a,b){d.View.apply(this);this.name="Box";this._mask=!1;this._children=[];this._element=document.createElement("div");this._element.style.position="absolute";this.id="smart-box"+d.guid++;void 0!=a&&(this.bg.width=a);void 0!=
b&&(this.bg.height=b);this._transOrigin()},mask:{get:function(){return this._mask},set:function(a){this._element.style.overflow=(this._mask=a)?"hidden":"visible"}},width:{get:function(){return this.bg.width},set:function(a){this.bg.width=a}},height:{get:function(){return this.bg.height},set:function(a){this.bg.height=a}},children:{get:function(){return this._children}},addChild:function(a){a._parent=this;this._children.push(a);this._element.appendChild(a.element);return a},removeChild:function(a){for(var b=
this._children.length;b--;)if(a==this._children[b])return this._children.slice(b,1),this._element.removeChild(a.element),a._parent=null,a}});d.Background=d.extend({init:function(a){this.name="Background";this._position=this._repeat=this._image=this._color="";this._height=this._width="auto";this._element=a},color:{get:function(){return this._color},set:function(a){this._element.style.backgroundColor=this._color=a}},image:{get:function(){return this._image},set:function(a){this._image=a;this._element.style.backgroundImage=
a?"url("+a+")":""}},width:{get:function(){return"number"==typeof this._width?this._width:this._element.offsetWidth},set:function(a){this._element.style.width="number"==typeof(this._width=a)?a+"px":a}},height:{get:function(){return"number"==typeof this._height?this._height:this._element.offsetHeight},set:function(a){this._element.style.height="number"==typeof(this._height=a)?a+"px":a}},repeat:{get:function(){return this._repeat},set:function(a){this._element.style.backgroundRepeat=this._repeat=a}},
position:{get:function(){return this._position},set:function(a){this._element.style.backgroundPosition=this._position=a}}});d.Border=d.extend({init:function(a){this.name="Border";this._element=a;this.color=this._color=["#000"];this.style=this._style=["solid"];this._width=[0];this._radius=[0]},color:{get:function(){return 1==this._color.length?this._color[0]:this._color},set:function(a){this._color=q(a);this._element.style.borderColor=r(this._color)}},width:{get:function(){return 1==this._width.length?
this._width[0]:this._width},set:function(a){this._width=q(a);this._element.style.borderWidth=r(this._width)}},style:{get:function(){return 1==this._style.length?this._style[0]:this._style},set:function(a){this._style=q(a);this._element.style.borderStyle=r(this._style)}},radius:{get:function(){return 1==this._radius.length?this._radius[0]:this._radius},set:function(a){this._radius=q(a);this._element.style[l+"BorderRadius"]=r(this._radius)}}});d.Stage=d.extend(d.Box,{init:function(a,b,c){d.Box.apply(this);
this.name="Stage";"string"==typeof a&&(a=document.getElementById(a));this.bg.width=b||parseInt(a.offsetWidth,10);this.bg.height=c||parseInt(a.offsetHeight,10);this._mouseY=this._mouseX=0;a.innerHTML="";a.style.textAlign="left";a.style.webkitTapHighlightColor="rgba(0,0,0,0)";a.appendChild(this._element);this.id="smart-stage"+d.guid++;this.mask=!0;var e=this;b=d.touchEnabled;this.bind(b?"touchmove":"mousemove",function(a){e._mouseX=a.mouseX;e._mouseY=a.mouseY});this.bind(b?"touchstart":"click",function(a){e._mouseX=
a.mouseX;e._mouseY=a.mouseY});window.addEventListener("resize",function(){var b=parseInt(a.offsetWidth,10),c=parseInt(a.offsetHeight,10);e.trigger("resize",{width:b,height:c})})},mouseX:{get:function(){return this._mouseX}},mouseY:{get:function(){return this._mouseY}},isStage:{get:function(){return!0}},resize:function(a){this.bind("resize",a)}});d.Text=d.extend(d.View,{init:function(a){d.View.apply(this);this.name="Text";this._element=document.createElement("span");this._element.style.position="absolute";
this._text=a||"";this._color="";this._size=14;this._font=d.defaultFont;this._italic=this._underline=this._bold=!1;this._align="left";this._lineHeight="1em";this._element.style.fontFamily=this._font;this._element.style.padding="3px";this._element.style.fontSize=this._size+"px";this._element.style.lineHeight=this._lineHeight;this.id="smart-text"+d.guid++;this.text=this._text;this._transOrigin()},text:{get:function(){return this._text},set:function(a){this._element.innerHTML=this._text=a}},width:{get:function(){return this.bg.width},
set:function(a){this.bg.width=a}},height:{get:function(){return this.bg.height},set:function(a){this.bg.height=a}},color:{get:function(){return this._color},set:function(a){this._element.style.color=this._color=a}},bold:{get:function(){return this._bold},set:function(a){this._element.style.fontWeight=(this._bold=a)?"bold":"normal"}},underline:{get:function(){return this._underline},set:function(a){this._element.style.textDecoration=(this._underline=a)?"underline":"none"}},italic:{get:function(){return this._italic},
set:function(a){this._element.style.fontStyle=(this._italic=a)?"italic":"normal"}},align:{get:function(){return this._align},set:function(a){this._element.style.textAlign=this._align=a}},size:{get:function(){return this._size},set:function(a){this._element.style.fontSize=(this._size=a)+"px"}},lineHeight:{get:function(){return this._lineHeight},set:function(a){this._lineHeight=a;this._element.style.lineHeight="number"==typeof a?a+"px":a}}});d.Canvas=d.extend(d.View,{init:function(a,b,c){d.View.apply(this);
this.name="Canvas";"object"==typeof a&&1==a.nodeType&&(c=a,a=c.width,b=c.height);this._element=document.createElement("canvas");this._element.style.position="absolute";this._element.width=this._width=a;this._element.height=this._height=b;this._ctx=this._element.getContext("2d");this.id="smart-canvas"+d.guid++;this._transOrigin();d.oldAndroid&&(a=Math.sqrt(320/n.screen.width),this._ctx.scale(a,a));if(c&&(this.draw(c),d.isAndroid40)){var e=this;setTimeout(function(){e._transReset();setTimeout(function(){e._transOrigin();
e._transform()},0)},0)}},width:{get:function(){return this._width*this._scaleX},set:function(a){this.scaleX=a/this._width}},height:{get:function(){return this._height*this._scaleY},set:function(a){this.scaleY=a/this._height}},draw:function(a,b,c,e,d,f,h,k,m){void 0==b&&(b=0);void 0==c&&(c=0);void 0==e&&(e=a.width);void 0==d&&(d=a.height);void 0==f&&(f=0);void 0==h&&(h=0);void 0==k&&(k=this._width);void 0==m&&(m=this._height);this._ctx.drawImage(a,b,c,e,d,f,h,k,m)},clear:function(){this._ctx.clearRect(0,
0,this._width+1,this._height+1)},context:{get:function(){return this._ctx}}});d.Animation=d.extend(d.Canvas,{init:function(a,b,c,e){d.Canvas.apply(this,[a,b]);this.name="Animation";this.id="smart-animation"+d.guid++;this._source=null;this._total=this._cols=1;var g=this;this._timeline=new d.Timeline(e);this._timeline.enterframe(function(a){g._source&&g._render(a.target.frame-1);g.trigger(a.type,a)});this._timeline.lastframe(function(a){g.trigger(a.type,a)});c&&(this.source=c)},fps:{set:function(a){var b=
this._timeline.active;this._timeline.stop();this._timeline.fps=a;b&&this._timeline.play()},get:function(){return this._timeline.fps}},source:{set:function(a){this._source=a;this._index=0;this._cols=Math.floor(this._source.width/this._width);this._timeline.total=this._cols*Math.floor(this._source.height/this._height)}},_render:function(a){a%=this._timeline.total;var b=a%this._cols*this._width;a=Math.floor(a/this._cols)*this._height;this.clear();this.draw(this._source,b,a,this._width,this._height,0,
0,this._width,this._height)},play:function(a){this._timeline.play(a)},frame:{get:function(){return this._timeline.frame},set:function(a){this._timeline.frame=a}},total:{get:function(){return this._timeline.total}},stop:function(a){this._timeline.stop(a)},toggle:function(){this._timeline.toggle()},repeat:{get:function(){return this._timeline.repeat},set:function(a){this._timeline.repeat=a}},enterframe:function(a){this.bind("enterframe",a)},lastframe:function(a){this.bind("lastframe",a)}});d.Timeline=
d.extend(d.Binder,{init:function(a){d.Binder.apply(this);this.name="Timeline";this._fps=a||(d.timeline?d.timeline.fps:30);this._timerID=this._total=this._frame=0;this._repeat=!0},fps:{get:function(){return this._fps},set:function(a){var b=this.active;this.stop();this._fps=a;b&&this.play()}},frame:{get:function(){return this._frame},set:function(a){this._frame!=a&&this.trigger("enterframe",{frame:this._frame=a,total:this._total})}},total:{get:function(){return this._total},set:function(a){this._total=
a}},repeat:{get:function(){return this._repeat},set:function(a){this._repeat=a}},play:function(a){void 0!=a&&(this._frame=a);if(!this._timerID){var b=this;this._timerID=setInterval(function(){b._frame++;b.trigger("enterframe",{frame:b._frame,total:b._total});0<b._total&&b._frame==b._total&&(b.trigger("lastframe",{frame:b._frame,total:b._total}),b._repeat?b._frame=0:b.stop())},1E3/this._fps)}},stop:function(a){void 0!=a&&(this.frame=a);this._timerID&&(clearInterval(this._timerID),this._timerID=null)},
active:{get:function(){return Boolean(this._timerID)}},toggle:function(){this.active?this.stop():this.play()},enterframe:function(a){this.bind("enterframe",a)},lastframe:function(a){this.bind("lastframe",a)}});d.Timetable=d.extend(d.Timeline,{init:function(a){d.Timeline.apply(this,[a]);this.name="Timetable";this._table=[];this.enterframe(function(a){if(a=this._table[a.frame-1])for(var c in a){var e;if("function"==typeof a[c])a[c].call(this);else if(e=a[c][0]){var d=a[c][1],f;for(f in d)e[f]=d[f]}}})},
frames:{set:function(a){this._table=a;this.total=a.length;this.frame=1}}});d.Tween=d.extend(d.Binder,{init:function(){d.Binder.apply(this);this.name="Tween";this._list=[];this._active=!1},active:{get:function(){return this._active}},_toFrame:function(a){return Math.ceil(d.timeline.fps*a)},start:function(a,b,c,e,g,f){var h=this._list,k=[];c||(c="linear");void 0==e&&(e=0.5);void 0==g&&(g=0);"function"!=typeof f&&(f=null);for(var m in b)if(b.hasOwnProperty(m)){var l=a[m],n=b[m],q=this._toFrame(e),r=
this._toFrame(g);k.push(new y(a,m,l,n,c,q,r))}f&&(k[k.length-1].cb=f);for(a=k.length;a--;){b=0;for(c=h.length;c--;)if(k[a].tar==h[c].tar&&k[a].prop==h[c].prop){h[c].cb&&h[c].cb(h[c].tar);h[c]=k[a];b=1;break}b||h.push(k[a])}if(!this._active){this._active=!0;var s=this;d.timeline.bind("enterframe",function(a){for(var b=s._list,c,e=b.length;e--;)c=b[e],0<c.delay?c.delay--:c.tar[c.prop]=c.ease(++c.time,c.stt,c.diff,c.total),c.time>=c.total&&(c.tar[c.param]!=c.end&&(c.tar[c.param]=c.end),b.splice(e,1),
c.cb&&c.cb(c.tar),c.cb=null,c.tar=null,c.ease=null);s.trigger("change");0==b.length&&(d.timeline.unbind("enterframe",arguments.callee),s._active=!1,s.trigger("complete"))})}},stop:function(a,b){for(var c=this._list,e,d=c.length;d--;)e=c[d],a&&e.tar!=a||b&&e.prop!=b||c.splice(d,1)}});var y=function(a,b,c,e,d,f,h){this.tar=a;this.prop=b;this.stt=c;this.diff=e-c;this.end=e;this.ease=z[d];this.time=0;this.total=f;this.delay=h;this.cb=null;this.ease||alert("smart.ease param error")},z={linear:function(a,
b,c,d){return c*a/d+b},easeInSine:function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},easeOutSine:function(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b},easeInOutSine:function(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b},easeInQuad:function(a,b,c,d){return c*(a/=d)*a+b},easeOutQuad:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOutQuad:function(a,b,c,d){return 1>(a/=d/2)?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},easeInCubic:function(a,b,c,d){return c*(a/=d)*a*a+b},easeOutCubic:function(a,b,c,d){return c*
((a=a/d-1)*a*a+1)+b},easeInOutCubic:function(a,b,c,d){return 1>(a/=d/2)?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b},easeInQuart:function(a,b,c,d){return c*(a/=d)*a*a*a+b},easeOutQuart:function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b},easeInOutQuart:function(a,b,c,d){return 1>(a/=d/2)?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b},easeInExpo:function(a,b,c,d){return 0==a?b:c*Math.pow(2,10*(a/d-1))+b-0.001*c},easeOutExpo:function(a,b,c,d){return a==d?b+c:1.001*c*(-Math.pow(2,-10*a/d)+1)+b},easeInOutExpo:function(a,b,
c,d){return 0==a?b:a==d?b+c:1>(a/=d/2)?c/2*Math.pow(2,10*(a-1))+b-5E-4*c:1.0005*(c/2)*(-Math.pow(2,-10*--a)+2)+b},easeInBack:function(a,b,c,d){return c*(a/=d)*a*(2.70158*a-1.70158)+b},easeOutBack:function(a,b,c,d){return c*((a=a/d-1)*a*(2.70158*a+1.70158)+1)+b},easeInOutBack:function(a,b,c,d){var g=1.70158;return 1>(a/=d/2)?c/2*a*a*(((g*=1.525)+1)*a-g)+b:c/2*((a-=2)*a*(((g*=1.525)+1)*a+g)+2)+b},easeOutBounce:function(a,b,c,d){return(a/=d)<1/2.75?c*7.5625*a*a+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+0.75)+
b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+0.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+0.984375)+b},easeOutElastic:function(a,b,c,d){p=1.08;if(0==a)return b;if(1==(a/=d))return b+c;p||(p=0.3*d);var g,f;!f||f<Math.abs(c)?(f=c,g=p/4):g=p/(2*Math.PI)*Math.asin(c/f);return f*Math.pow(2.5,-10*a)*Math.sin((a*d-g)*2*Math.PI/p)+c+b}};d.timeline=new d.Timeline;d.timeline.play();d.tween=new d.Tween;d.wait=function(a,b){var c=this;d.tween.start({i:0},{i:1},"linear",a,0,function(){b.call(c)})};var u=[],v=0;n.addEventListener("load",
function(){n.removeEventListener("load",arguments.callee);v=1;for(var a=0,b=u.length;a<b;a++)u[a].call(this)});var A=function(a){for(var b in a)return!1;return!0},w=function(a,b){"function"===typeof a?a(d,null):"function"===typeof b?A(a)?b(d,null):(new d.Assets).load(a,function(a){b(d,a)}):alert("smart.ready param error")};d.ready=function(a,b){v?w(a,b):u.push(function(){w(a,b)})}}else d.ready=function(a,b){}}})(window);