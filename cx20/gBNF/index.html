<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>[GLSL] Glitchy Mario - js do it</title>
<meta name="Description" content="" />
<meta name="Keywords"  content="" />

<link rel="stylesheet" type="text/css" media="screen,print" href="style.css" />
</head>
<body>
<!-- generated by: jsdo.it - http://jsdo.it/cx20/gBNF -->
<!-- Copyright cx20 - http://jsdo.it/cx20 -->
<!-- Licensed under MIT License - http://www.opensource.org/licenses/mit-license.php -->
<!DOCTYPE html><script id="f" type="x/f">precision mediump float;
uniform vec2 r;
uniform float t;

// add) B >= C && B < (C+16)
#define F(A,B,C,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p)A=B>=C&&B<(C+16)?B==(C+0)?a:B==(C+1)?b:B==(C+2)?c:B==(C+3)?d:B==(C+4)?e:B==(C+5)?f:B==(C+6)?g:B==(C+7)?h:B==(C+8)?i:B==(C+9)?j:B==(C+10)?k:B==(C+11)?l:B==(C+12)?m:B==(C+13)?n:B==(C+14)?o:B==(C+15)?p:A:A

#define U vec3(0.0,1.0,0.0)
#define V vec3(1.0,0.8,0.8)
#define W vec3(0.5,0.0,0.0)
#define X vec3(1.0,0.0,0.0)
#define Y vec3(1.0,1.0,0.0)
#define Z vec3(0.0,0.0,1.0)
#define _ vec3(0.)

// Random number used by 2D noise function...
float random(vec2 ab) 
{
	float f = (cos(dot(ab ,vec2(21.9898,78.233))) * 43758.5453);
	return fract(f);
}

void main() {
	vec3 m0 = vec3(0.0);
	for ( int c = 0; c < 3; c++ ) {
		vec2 p = gl_FragCoord.xy/r.xy;
		if ( c == 0 ) { p.x += random(vec2(sin(t))) * 0.03; }
		if ( c == 1 ) { p.y += random(vec2(cos(t))) * 0.05; }
		if ( c == 2 ) { p += random(vec2(sin(t))) * 0.02; }
		vec3 m = vec3(0.0);

		float x = floor(p.x * 16.0);
		float y = floor((1.0 - p.y) * 16.0);
		int i = int(x + y * 16.0);
		
		F(m,i,  0,_,_,_,_,_,_,_,_,_,_,_,_,_,V,V,V);
		F(m,i, 16,_,_,_,_,_,_,X,X,X,X,X,_,_,V,V,V);
		F(m,i, 32,_,_,_,_,_,X,X,X,X,X,X,X,X,X,V,V);
		F(m,i, 48,_,_,_,_,_,W,W,W,V,V,W,V,_,X,X,X);
		F(m,i, 64,_,_,_,_,W,V,W,V,V,V,W,V,V,X,X,X);
		F(m,i, 80,_,_,_,_,W,V,W,W,V,V,V,W,V,V,V,X);
		F(m,i, 96,_,_,_,_,W,W,V,V,V,V,W,W,W,W,X,_);
		F(m,i,112,_,_,_,_,_,_,V,V,V,V,V,V,V,X,_,_);
		F(m,i,128,_,_,X,X,X,X,X,Z,X,X,X,Z,X,_,_,_);
		F(m,i,144,_,X,X,X,X,X,X,X,Z,X,X,X,Z,_,_,W);
		F(m,i,160,V,V,X,X,X,X,X,X,Z,Z,Z,Z,Z,_,_,W);
		F(m,i,176,V,V,V,_,Z,Z,X,Z,Z,Y,Z,Z,Y,Z,W,W);
		F(m,i,192,_,V,_,W,Z,Z,Z,Z,Z,Z,Z,Z,Z,Z,W,W);
		F(m,i,208,_,_,W,W,W,Z,Z,Z,Z,Z,Z,Z,Z,Z,W,W);
		F(m,i,224,_,W,W,W,Z,Z,Z,Z,Z,Z,Z,_,_,_,_,_);
		F(m,i,240,_,W,_,_,Z,Z,Z,Z,_,_,_,_,_,_,_,_);
		
		if ( c == 0 ) { m.r = m.r; m.g = 0.0; m.b = 0.0; }
		if ( c == 1 ) { m.r = 0.0; m.g = m.g; m.b = 0.0; }
		if ( c == 2 ) { m.r = 0.0; m.g = 0.0; m.b = m.b; }
		m0 += m;
	}

	gl_FragColor = vec4(m0, 1.0);
}
</script>
<script id="v" type="x/v">attribute vec3 p;void main(){gl_Position=vec4(p,1.);}</script>
<!-- forked from https://github.com/doxas/js4kintro/blob/master/src/index.html -->
<script>w=window;w.onload=function(){b=function(s){return document.getElementById(s)};w.addEventListener('keydown',k,1);c=b('c');g=c.getContext('webgl')||c.getContext('experimental-webgl');p=g.createProgram();h=function(i,j){k=g.createShader(35633-i);g.shaderSource(k,j);g.compileShader(k);g.attachShader(p,k);return g.getShaderInfoLog(k);};if(!h(0,b('v').text)&&!h(1,b('f').text)){g.linkProgram(p);}e=g.getProgramParameter(p, 35714);g.useProgram(p);u={};u.t=g.getUniformLocation(p,'t');u.r=g.getUniformLocation(p,'r');g.bindBuffer(34962,g.createBuffer());g.bufferData(34962,new Float32Array([-1,1,0,-1,-1,0,1,1,0,1,-1,0]),35044);a=g.getAttribLocation(p,'p');g.enableVertexAttribArray(a);g.vertexAttribPointer(a,3,5126,0,0,0);g.clearColor(0,0,0,1);z=Date.now();(function(){if(!e){return;}c.width=x=w.innerWidth;c.height=y=w.innerHeight;g.viewport(0,0,x,y);d=(Date.now()-z)*.001;g.clear(16384);g.uniform1f(u.t,d);g.uniform2fv(u.r,[x,y]);g.drawArrays(5,0,4);g.flush();requestAnimationFrame(arguments.callee);})();function k(h){e=(h.keyCode!==27);}};</script><style>*{margin:0;padding:0;overflow:hidden}html,body{height:100%}</style><canvas id="c"></canvas>

<script type="text/javascript" src="index.js"></script>
</body>
</html>
