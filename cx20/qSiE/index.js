// forked from cx20's "[簡易版] WebGL で３次元関数をプロットしてみるテスト" http://jsdo.it/cx20/8H2X
// forked from cx20's "[簡易版] WebGL で３次元リサージュ図形を描いてみるテスト" http://jsdo.it/cx20/yoSK
// forked from cx20's "[簡易版] WebGL でリサージュ図形を描いてみるテスト" http://jsdo.it/cx20/9Dru
// forked from cx20's "[簡易版] WebGL で円を角度をつけて回転させてみるテスト" http://jsdo.it/cx20/5vCG
// forked from cx20's "[簡易版] WebGL で円を描いてみるテスト" http://jsdo.it/cx20/dz02
// forked from cx20's "[簡易版] WebGL でサインカーブを描いてみるテスト" http://jsdo.it/cx20/fPok
// forked from cx20's "[簡易版] WebGL で点をプロットしてみるテスト" http://jsdo.it/cx20/puXG
// forked from cx20's "[簡易版] WebGL で四角形を描いてみるテスト" http://jsdo.it/cx20/vwnxi
// forked from cx20's "[簡易版 30行で WebGL を試してみるテスト" http://jsdo.it/cx20/oaQC
var c, gl;
var stats;

var aLoc = [];
var uLoc = [];

function initWebGL() {
    c = document.getElementById("c");
    gl = c.getContext("experimental-webgl");
    resizeCanvas();
    window.addEventListener("resize", function(){
        resizeCanvas();
    });

    // Stats
    stats = new Stats();
    // 左上に設定
    stats.domElement.style.position = "fixed";
    stats.domElement.style.left     = "5px";
    stats.domElement.style.top      = "5px";
    document.body.appendChild(stats.domElement);
}

function resizeCanvas() {
    c.width = window.innerWidth;
    c.height = window.innerHeight;
    //gl.viewport(0, 0, c.width, c.heihgt);
    gl.viewport(window.innerWidth/2 - c.height/2, 0, c.height, c.height); // TODO: Temporarily adjusted to square for full screen display
}

function initShaders() {
    var p = gl.createProgram();
    var vs = gl.createShader(gl.VERTEX_SHADER);
    var fs = gl.createShader(gl.FRAGMENT_SHADER);
    var v = document.getElementById("vs").textContent;
    var f = document.getElementById("fs").textContent;
    gl.shaderSource(vs, v);
    gl.shaderSource(fs, f);
    gl.compileShader(vs);
    gl.compileShader(fs);
    gl.attachShader(p, vs);
    gl.attachShader(p, fs);
    gl.linkProgram(p);
    gl.useProgram(p);
    aLoc[0] = gl.getAttribLocation(p, "position");
    uLoc[0] = gl.getUniformLocation(p, 'matAxisX');
    uLoc[1] = gl.getUniformLocation(p, 'matAxisY');
    gl.enableVertexAttribArray(aLoc[0]);
}

function draw() {
    // 3次元関数の座標データを用意
    //             1.0 y 
    //              ^  -1.0 
    //              | / z
    //              |/       x
    // -1.0 -----------------> +1.0
    //            / |
    //      +1.0 /  |
    //           -1.0
    // 
/*
    var data = [];
    for ( var j = -10; j < 10; j += 0.5 ) {
        for ( var i = -10; i < 10; i += 0.5) {
            var x = i;
            var y = j;
            var z = Math.sin(Math.sqrt(x*x+y*y))/Math.sqrt(x*x+y*y);
            data = data.concat([x/10, y/10, z/5]);
        }
    }
*/
    // 小惑星データ（頂点数:300個）
    var data = [
        -8.1374, 43.5332, 48.7737,
        34.2116, 43.8496, 42.2780,
        62.5936, 27.6945, 37.0054,
        -25.5737, 43.5227, 48.6314,
        37.4963, 31.0689, 50.2553,
        -81.1989, 38.1921, 44.2393,
        11.5344, 38.6034, 50.4715,
        -71.2761, 25.2744, 50.3924,
        -48.2983, 31.1691, 54.2730,
        -32.6600, 29.5979, 56.3240,
        -5.4854, 23.3131, 58.3592,
        12.4202, 23.9088, 56.3451,
        24.2095, 16.1951, 56.8038,
        -66.1353, 4.8434, 53.6297,
        -45.5777, 14.0228, 58.6123,
        -19.1729, 8.6185, 62.5034,
        5.2337, 7.5113, 60.8478,
        38.5825, 9.5675, 56.6878,
        20.3448, -3.9512, 58.4436,
        -70.6381, -12.0604, 49.2904,
        -9.4661, -13.3996, 60.4471,
        36.8267, -9.4399, 58.6914,
        -51.3142, -1.6840, 57.5314,
        -34.2576, -15.0552, 58.6176,
        -89.5348, -22.0729, 39.5099,
        -84.8528, -9.4083, 44.4344,
        52.7920, -23.0167, 57.2361,
        -50.0647, -19.7372, 53.7563,
        -23.9761, -27.2927, 55.0480,
        19.9283, -27.8200, 52.8441,
        -40.1628, -31.7217, 50.4346,
        36.6158, -27.1029, 55.4751,
        2.4867, -31.0046, 52.7229,
        -60.1036, -29.0432, 46.5803,
        -76.7753, -34.4423, 38.4712,
        47.4772, -40.8115, 47.4925,
        -52.0893, -42.4513, 40.6277,
        -23.0165, -40.7377, 46.5962,
        -7.3940, -42.9364, 45.3782,
        26.1973, -44.7027, 43.7437,
        -73.0792, -50.3759, 29.8717,
        5.7346, -48.9259, 40.6646,
        -85.6701, -52.8803, 24.1457,
        -37.0151, -52.1791, 34.9228,
        -18.3029, -57.9209, 29.4288,
        -41.1751, -60.7259, 24.0824,
        -57.2880, -58.5220, 25.2424,
        20.3395, -60.1565, 27.0878,
        4.4006, -63.7629, 21.0086,
        60.3528, -51.4462, 18.0032,
        43.5229, -56.3708, 29.2812,
        -12.4187, -69.1197, 10.2368,
        -30.4297, -67.5116, 15.8151,
        25.3484, -67.1162, 8.0909,
        -82.2271, -63.2567, 12.1033,
        -48.0083, -70.2270, 12.2825,
        -32.7391, -74.9565, 2.8447,
        -62.2969, -74.1867, -2.8708,
        48.1047, -61.1160, 11.4073,
        -69.6731, -69.0407, 7.8114,
        3.6309, -70.3799, 2.1329,
        67.5287, -46.7220, 0.5248,
        -99.7425, -61.1846, -2.4648,
        5.6028, -67.1109, -11.4123,
        -44.8290, -77.8089, -10.6688,
        -28.7794, -76.3484, -11.9975,
        -11.9231, -71.5188, -12.6935,
        -82.8598, -65.4396, -13.2049,
        45.8428, -58.3163, -2.5597,
        -67.4851, -70.7015, -17.9396,
        -48.6041, -71.5715, -24.0822,
        29.2606, -57.6414, -13.1311,
        -92.6984, -59.0650, -20.9081,
        56.6831, -46.0946, -9.4561,
        -25.3734, -67.2691, -26.4021,
        41.9622, -47.1227, -15.8517,
        -76.3324, -57.8101, -31.9593,
        -40.3474, -60.6362, -34.8856,
        -6.7824, -62.4658, -26.0383,
        54.6269, -35.2859, -22.1629,
        -57.4779, -58.5642, -34.7959,
        17.3711, -55.7644, -20.4968,
        30.4839, -41.4232, -25.2790,
        -33.5616, -49.8275, -40.5536,
        8.6029, -44.7607, -34.6747,
        -93.2256, 16.3375, 43.0425,
        -83.4240, 5.6922, 47.1920,
        -95.7248, 30.6683, 41.0494,
        -104.3401, 50.0343, 32.3972,
        -98.7406, -1.2148, 40.1004,
        -109.1909, 37.1693, 34.8595,
        -106.2540, -17.9867, 33.0299,
        -96.8847, -34.9115, 31.6116,
        -110.7304, 14.0756, 35.7136,
        -115.4335, -29.7708, 22.7801,
        -127.9505, 13.9701, 24.1984,
        -117.5900, -10.5630, 28.1159,
        -124.4496, 32.4504, 26.9402,
        -106.1750, 66.3422, 22.1474,
        -129.9647, 44.8988, 20.3284,
        -99.0307, -53.3602, 16.7695,
        -134.0192, -4.9214, 15.4724,
        -139.9086, 33.4733, 12.8994,
        -140.2724, 8.8769, 10.9433,
        -129.2687, -24.1978, 12.4354,
        -115.8659, -45.8942, 9.3088,
        -126.3635, 57.9694, 14.2228,
        -114.1629, 71.2404, 4.8641,
        -142.1651, -6.4240, -0.8303,
        -135.4059, -28.1733, -5.4807,
        -144.9122, 39.7001, -2.2328,
        -127.6236, -39.3932, -0.1027,
        -118.4019, -54.8998, -5.8181,
        -132.3425, 61.7762, -7.4315,
        -120.1525, 67.0856, -17.4493,
        -143.5520, 48.1203, -16.1733,
        -140.0721, 5.8346, -24.6147,
        -104.3560, 70.1068, -21.9995,
        -140.9686, -18.5298, -14.6654,
        -143.9844, 14.1177, -9.3191,
        -123.6957, -45.1666, -17.4915,
        -140.7100, 25.5908, -24.3036,
        -132.8171, 42.0569, -34.4005,
        -136.7135, -17.4120, -33.0613,
        -106.1274, -55.1633, -19.6532,
        -136.2494, -3.7667, -36.2881,
        -131.5254, -32.6707, -24.7412,
        -123.0997, 58.5547, -29.1016,
        -129.3794, 23.5503, -40.8594,
        -114.9116, -37.4002, -38.0913,
        -129.7959, 7.7116, -42.6995,
        -122.2457, -11.8442, -51.0723,
        -115.2647, 2.6922, -56.2762,
        -126.4742, -24.3348, -41.7135,
        -122.3089, 35.8195, -44.6292,
        -101.0501, 57.9536, -34.8645,
        -108.2734, -25.0941, -51.7156,
        -102.9270, -10.6052, -59.7983,
        -106.6969, 46.0377, -43.2320,
        -108.1890, 28.9968, -52.7384,
        -99.1256, 19.4852, -59.8458,
        -93.0358, 1.2264, -62.4662,
        4.5430, 48.6423, 43.5276,
        -62.0966, 47.3927, 45.1990,
        -9.9881, 54.1678, 40.0266,
        -48.0769, 48.1836, 44.8299,
        -78.2833, 55.6179, 37.9387,
        -38.4440, 56.3824, 37.6329,
        -57.0297, 59.3877, 37.5485,
        42.6160, 43.4436, 29.4763,
        21.1304, 51.9007, 34.2215,
        -25.8268, 60.3421, 32.6292,
        -90.8477, 64.1067, 30.0193,
        -70.8332, 68.4407, 27.5570,
        49.8288, 42.4681, 15.9680,
        -4.1989, 62.2402, 22.1264,
        -40.5002, 69.0102, 22.4321,
        -90.2783, 74.6939, 18.8679,
        28.0691, 50.1766, 6.8307,
        7.5800, 57.2840, 28.1159,
        -19.9743, 66.2104, 19.3530,
        -55.1052, 72.1525, 18.9997,
        7.8436, 56.5564, 2.7340,
        -44.8395, 72.8802, 5.0011,
        71.1721, 43.0587, 9.2561,
        -97.4542, 77.7678, -0.4454,
        -7.6840, 63.5689, 6.3931,
        -28.6950, 69.1577, -1.6264,
        -62.8189, 73.1965, 1.7005,
        -79.2534, 76.1280, 5.4862,
        46.6284, 42.7529, 0.9202,
        -75.2094, 73.6130, -9.0818,
        -80.9986, 69.6955, -22.8537,
        -13.1727, 61.3069, -7.3788,
        -46.8378, 69.0945, -12.9360,
        62.3880, 43.6967, -4.2522,
        -61.8435, 69.9328, -16.0257,
        -0.2919, 51.7478, -14.5336,
        -50.4706, 57.5002, -32.6395,
        15.0248, 48.0992, -11.3964,
        -9.5188, 47.9991, -24.8361,
        33.5947, 42.8056, -10.7637,
        -67.3902, 58.6548, -34.9330,
        -28.1836, 58.2172, -23.7342,
        23.1498, 39.2941, -21.0926,
        -84.7684, 56.3402, -36.8786,
        52.3596, 39.1992, -18.0978,
        41.9569, 31.6753, -29.7449,
        -25.6475, 46.5228, -33.5622,
        -39.0240, 40.4962, -42.6151,
        60.9960, -6.1973, 55.8337,
        60.2790, -42.8414, 38.3657,
        75.2582, -21.1186, 44.3342,
        59.4828, 14.8612, 50.1130,
        87.3850, 13.2847, 37.5643,
        76.6977, 32.7930, 24.9788,
        73.1176, -41.0540, 26.7029,
        83.0985, -2.9020, 43.6541,
        92.6418, -18.1554, 33.4834,
        87.2163, -31.8482, 26.7187,
        103.5718, -4.6419, 34.3534,
        106.7932, -21.9095, 26.2969,
        103.9409, 18.1091, 26.8927,
        116.4684, -9.2712, 26.5553,
        94.5399, 29.7403, 23.4603,
        121.5353, 3.8416, 20.3970,
        102.8811, 39.8583, 12.1560,
        109.9727, -33.4194, 17.3020,
        129.7816, 17.0704, 10.1155,
        115.6037, 31.1955, 12.8467,
        88.5503, 44.6246, 9.9415,
        125.1574, -16.7424, 15.1613,
        88.1496, -46.7010, 12.0294,
        135.8291, -0.7983, 6.7727,
        124.6882, -30.5195, 4.3315,
        137.6165, -18.0394, -6.5299,
        139.5620, 17.4131, -4.4367,
        133.6990, 29.5874, -9.1082,
        114.2856, 42.9954, -1.9691,
        106.5297, -42.9627, 5.9555,
        144.2440, 0.1561, -9.8410,
        129.4336, -32.0170, -11.4861,
        144.9875, 14.4446, -28.5427,
        94.2499, 52.5914, -7.3313,
        91.2076, -46.3793, -6.6670,
        112.4665, -47.6975, -8.7760,
        145.4250, -4.5734, -27.8942,
        132.6973, 34.3538, -24.3300,
        106.5928, 48.8848, -25.0154,
        120.2172, 41.3504, -19.8430,
        137.2211, 29.2288, -40.6379,
        99.4803, -45.0243, -23.7447,
        120.3385, -42.7782, -20.1963,
        133.8571, -26.4913, -26.3019,
        136.5250, -11.1061, -42.5149,
        138.8977, 8.0385, -49.9176,
        128.2578, 39.8952, -37.8962,
        112.4612, 41.1500, -47.8191,
        128.2155, -23.6810, -40.2108,
        89.3623, 51.2733, -24.7307,
        113.2099, -36.1506, -35.3759,
        123.9132, 31.9600, -52.9335,
        79.4341, 50.8304, -7.9904,
        126.6022, -2.7913, -58.7491,
        83.2092, -41.4073, -20.4494,
        120.8868, -15.2872, -54.3096,
        121.5300, 11.6238, -61.6542,
        68.0454, 43.8127, -18.6462,
        105.3592, -11.5226, -57.8000,
        93.3905, 42.2362, -44.7557,
        78.1265, -32.1962, -30.0876,
        99.1639, -29.8288, -45.4465,
        107.5473, 4.5059, -60.5839,
        104.2255, 22.5591, -56.5768,
        77.3725, 44.5772, -29.6025,
        90.5644, -16.8637, -49.2058,
        89.0089, -1.5575, -50.8456,
        89.9950, 19.5010, -52.2269,
        77.1510, 31.6964, -42.7996,
        66.7853, 30.0092, -33.4989,
        75.5904, -13.9901, -40.0790,
        60.6375, -20.3066, -33.3460,
        74.6045, 13.9174, -43.5536,
        -64.7487, -41.4389, -45.3199,
        -8.3167, -46.8433, -38.9929,
        -19.5578, -31.9273, -45.2830,
        -88.9496, -41.9715, -43.1266,
        -73.7278, -30.3244, -51.9633,
        -44.5812, -35.3913, -47.0282,
        -2.6329, -24.2558, -44.5765,
        41.1819, -26.7549, -33.1562,
        20.3870, -30.3825, -35.9032,
        -33.5141, -25.3103, -48.9527,
        -51.0190, -22.2838, -52.6382,
        -77.3500, -17.4858, -57.4625,
        -90.2361, -26.1644, -53.6559,
        5.9982, -8.2589, -44.7821,
        36.5737, -11.8706, -41.0123,
        -33.7778, -7.5682, -53.1022,
        61.7500, 0.1508, -39.3567,
        -63.4833, -7.6789, -58.3800,
        18.4783, 7.5482, -41.7082,
        -16.6262, -8.3907, -49.9017,
        -75.7102, 11.2126, -60.5048,
        -5.1690, 11.3708, -45.7945,
        -50.8661, -0.4661, -56.2340,
        38.7512, 7.9383, -42.7311,
        51.7638, 13.6432, -38.9560,
        -37.5529, 13.3849, -52.3218,
        -21.9462, 10.7222, -50.1812,
        -59.8874, 14.5923, -56.6823,
        25.5646, 26.4449, -34.4691,
        -44.6128, 26.2604, -50.3816,
        -9.2025, 33.6894, -36.3144,
        11.6557, 26.9985, -35.2757,
        -66.2144, 29.0285, -52.7542,
        -23.8865, 31.4433, -42.2460,
        -86.8194, 37.8705, -49.9123,
        5.2443, 39.4470, -26.9821,
        -60.9893, 41.8460, -45.7681
    ];

    gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(data), gl.STATIC_DRAW);
    gl.vertexAttribPointer(0, 3, gl.FLOAT, false, 0, 0);

    var rad = 0;
    (function(){
        rad += Math.PI * 1.0 / 180.0;

        var c = Math.cos(rad);
        var s = Math.sin(rad);

        // 変換行列を用意
        // x軸で回転
        var matAxisX = [
            1.0, 0.0, 0.0, 0.0,
            0.0,   c,  -s, 0.0,
            0.0,   s,   c, 0.0,
            0.0, 0.0, 0.0, 1.0
        ];
        // y軸で回転
        var matAxisY = [
              c, 0.0,   s, 0.0,
            0.0, 1.0, 0.0, 0.0,
             -s, 0.0,   c, 0.0,
            0.0, 0.0, 0.0, 1.0
        ];
        gl.uniformMatrix4fv(uLoc[0], false, new Float32Array(matAxisX));
        gl.uniformMatrix4fv(uLoc[1], false, new Float32Array(matAxisY));

        //gl.drawArrays(gl.LINE_STRIP, 0, data.length / 3);
        gl.drawArrays(gl.POINTS, 0, data.length / 3);
        gl.flush();
        requestAnimationFrame(arguments.callee);

        // stats 更新
        stats.update();
    })();
}

initWebGL();
initShaders();
draw();