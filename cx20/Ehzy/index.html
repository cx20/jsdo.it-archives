<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>[WebGL] Grimoire.js で render-quad を使ってシェーダを実行してみるテスト（その３） - js do it</title>
<meta name="Description" content="" />
<meta name="Keywords"  content="" />

<link rel="stylesheet" type="text/css" media="screen,print" href="style.css" />
</head>
<body>
<!-- generated by: jsdo.it - http://jsdo.it/cx20/Ehzy -->
<!-- Copyright cx20 - http://jsdo.it/cx20 -->
<!-- Licensed under MIT License - http://www.opensource.org/licenses/mit-license.php -->
<!-- grimoire-preset-basic.js v1.10.16 -->
<script src="https://unpkg.com/grimoirejs-preset-basic@1.10.16/register/grimoire-preset-basic.js"></script>

<script type="text/sort" id="shader" typeName="shader">
@Pass{
FS_PREC(highp,float)
#ifdef VS
  attribute vec3 position;
  void main(){
    gl_Position = vec4(position, 1.);
  }
#endif

#ifdef FS
  // forked from http://glslsandbox.com/e#39606.0
  uniform float _time;
  uniform vec2 _viewportSize;
  #define MAX_ITER 3
  
  void main( void )
  {
      vec2 v_texCoord = gl_FragCoord.xy / _viewportSize;
      vec2 p =  v_texCoord * 9.0 - vec2(20.0);
      vec2 i = p;
      float c = 2.0;
      float inten = .05;
  
      for (int n = 0; n < MAX_ITER; n++)
      {
          float t = _time / 1000.0 * (1.0 - (0.060 / float(n+1)));
          i = p + vec2(cos(t - i.x) + sin(t + i.y),
          sin(t - i.y) + cos(t + i.x));
          c += 1.0/length(vec2(p.x / (sin(i.x+t)/inten),
          p.y / (cos(i.y+t)/inten)));
      }
  
      c /= float(MAX_ITER);
      c = 1.5 - sqrt(c);
  
      vec4 texColor = vec4(0.02, 0.15, 0.32, 1.);
      texColor.rgb *= (1.0 / (1.0 - (c + 0.05)));
      gl_FragColor = texColor;
  }
#endif
}
</script>
<script type="text/goml" id="canvas">
<goml width="fit" height="fit">
  <!-- <import-material typeName="shader" src="index.sort"/> -->
  <renderer>
    <texture-buffer name="b1"/>
    <render-quad material="new(shader)" out="b1"/>
    <render-scene />
  </renderer>
  <scene>
    <camera position="0,0,5">
      <camera.components>
        <MouseCameraControl/>
      </camera.components>
    </camera>
    <mesh geometry="cube" texture="backbuffer(b1)">
      <mesh.components>
        <Rotate />
      </mesh.components>
    </mesh>
  </scene>
</goml>
</script>



<script type="text/javascript" src="index.js"></script>
</body>
</html>
