<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>[WebGL] Grimoire.js でインスタンシング機能を使ってみるテスト（その３）（調整中） - js do it</title>
<meta name="Description" content="" />
<meta name="Keywords"  content="" />

<link rel="stylesheet" type="text/css" media="screen,print" href="style.css" />
</head>
<body>
<!-- generated by: jsdo.it - http://jsdo.it/cx20/u3rD -->
<!-- Copyright cx20 - http://jsdo.it/cx20 -->
<!-- Licensed under MIT License - http://www.opensource.org/licenses/mit-license.php -->
<!-- grimoire-preset-basic.js v1.9.24 -->
<script src="https://unpkg.com/grimoirejs-preset-basic@1.9.24/register/grimoire-preset-basic.js"></script>
<script src="https://unpkg.com/grimoirejs-forward-shading@1.4.3/register/grimoire-forward-shading.js"></script>

<script type="text/sort" id="shader">
@Pass{
  FS_PREC(mediump,float)

  varying vec3 vColor;

  varying vec2 uv;
  #ifdef VS
    @POSITION
    attribute vec3 position;

    @TEXCOORD
    attribute vec2 texcoord;
    
    @POSITION_BASE
    attribute vec3 posBase;

    @RANDOM_SEED
    attribute float seed;

    uniform float _time;

    uniform mat4 _matPVM;
    vec3 hsv2rgb(vec3 c)
    {
      vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
      vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
      return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
    }

    void main(){
        //uv = position.xy /2.0 + vec2(0.5);
      uv = texcoord;
      vColor = hsv2rgb(vec3(cos(_time/1000. + seed * seed),1,1));
      gl_Position = _matPVM * vec4(position * 0.1 + posBase * 0.1 + vec3(0,sin(_time/1000. + seed),cos(_time/1000. + seed)),1);
    }
  #endif

  #ifdef FS
  uniform sampler2D texture;
    void main(){
      vec3 texColor = texture2D(texture,uv).rgb;
      if(length(texColor)/1.73<0.3){
        discard;
      }else{
        gl_FragColor = vec4(vColor* texColor,1.);
      }
/*
      gl_FragColor = vec4(texColor, 1.0);
*/
    }
  #endif
}
</script>

<script type="text/goml" id="canvas">
<goml width="fit" height="fit">
  <renderer camera=".camera" viewport="0,0,100%,100%">
    <render-scene/>
  </renderer>
    <geometry type="cube2" name="cube2"/>
  <scene>
    <camera class="camera" near="0.01" far="4000.0" aspect="1.0" fovy="45d" position="0,12,17" rotation="-35,0,0" >
      <camera.components>
        <StareAt center="0,0,0" speed="0.007" zoom="20" zoomPhase="1"/>
        <!-- <MouseCameraControl/> -->
      </camera.components>
    </camera>
<!--
    <light rotation="-30d,180d,0d" type="directional" color="white"/>
    <light rotation="+30d,-180d,0d" type="directional" color="white"/>
-->
  </scene>
</goml>
</script>



<script type="text/javascript" src="index.js"></script>
</body>
</html>
