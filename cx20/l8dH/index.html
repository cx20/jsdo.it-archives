<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>[簡易版] GLSL でパーティクルの形を変えてみるテスト（その３） - js do it</title>
<meta name="Description" content="" />
<meta name="Keywords"  content="" />

<link rel="stylesheet" type="text/css" media="screen,print" href="style.css" />
</head>
<body>
<!-- generated by: jsdo.it - http://jsdo.it/cx20/l8dH -->
<!-- Copyright cx20 - http://jsdo.it/cx20 -->
<!-- Licensed under MIT License - http://www.opensource.org/licenses/mit-license.php -->
<script id="vs" type="x-shader/x-vertex">
attribute vec3 position;
uniform mat4 matPerspective;
uniform float time;
varying vec4 vColor;
varying float vTime;

void main()
{
    vec3 p = position;
    vColor = vec4(p.x+0.5, p.y+0.5, p.z/2.0+0.5, 1.0);
    vTime = time;
    
    p.y -= 1.0 * mod(time * 0.5, 2.0);
    if ( p.y < -1.0 ) {
        p.y += 2.0;
    }
    gl_Position = matPerspective * vec4(p, 1.0);
    
    //gl_PointSize = 32.0 * ( 1.0 / length( gl_Position.xyz ) );
    gl_PointSize = 32.0 * ( 1.0 / length( gl_Position.z ) );
}
</script>

<script id="fs" type="x-shader/x-fragment">
// forked from http://glslsandbox.com/e#27496.0
precision mediump float;
varying vec4 vColor;
varying vec3 vPosition;
varying float vTime;
uniform vec2  resolution; // resolution

#define MAX_ITER 10
void main( void ) {
    vec2 center = vec2(0.5, 0.5);
    vec2 p = (gl_PointCoord.xy - center) * 2.0;
    //vec3 light_color = vColor.rgb + 0.5; // vec3(1.2,0.8,0.6);
    vec3 light_color = vec3(1.2, 0.8, 0.6);

    float t = vTime * 2.0;

    // 256 angle steps
    float angle = atan(p.y, p.x) / (2. * 3.14159265359);
    angle -= floor(angle);
    float rad = length(p);

    float color = 0.0;

    float angleFract = fract(angle * 256.);
    float angleRnd = floor(angle * 256.) + 1.;
    float angleRnd1 = fract(angleRnd * fract(angleRnd * .7235) * 45.1);
    float angleRnd2 = fract(angleRnd * fract(angleRnd * .82657) * 13.724);
    float t2 = t + angleRnd1 * 10.;
    float radDist = sqrt(angleRnd2);

    float adist = radDist / rad * .1;
    float dist = (t2 * .1 + adist);
    dist = abs(fract(dist) - .5);
    color += (1.0 / (dist)) * cos(0.7 * (sin(t))) * adist / radDist / 30.0;

    angle = fract(angle + .61);

    vec3 col = vec3(color) * light_color;

    if (col.r > 0.2 || col.g > 0.2 || col.b > 0.2) {
        gl_FragColor = vec4(col.rgb, 1.0);
    } else {
        discard;
    }
}
</script>

<!-- stats.js r12 -->
<script src="../../assets/o/L/t/z/oLtzH.js"></script>

<canvas id="c" width="465" height="465"></canvas>

<script type="text/javascript" src="index.js"></script>
</body>
</html>
