<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>[WebVR] A-Frame + ShaderMaterial を試してみるテスト - js do it</title>
<meta name="Description" content="" />
<meta name="Keywords"  content="" />

<link rel="stylesheet" type="text/css" media="screen,print" href="style.css" />
</head>
<body>
<!-- generated by: jsdo.it - http://jsdo.it/cx20/cHDI -->
<!-- Copyright cx20 - http://jsdo.it/cx20 -->
<!-- Licensed under MIT License - http://www.opensource.org/licenses/mit-license.php -->
<!-- aframe.js v0.8.2 -->
<script src="https://unpkg.com/aframe@0.8.2"></script>

<script>
AFRAME.registerShader('my-custom', {
  schema: {
    time: { type: 'time', is: 'uniform' },
  },
  fragmentShader:
`
precision mediump float;
uniform float time;
uniform vec2 resolution;
varying vec2 vUv;

int getPixel(int x, int y)
{
    int a = x + (16-y) * 16;

    // https://glsl.heroku.com/e#14516.0
    if(a >   0 && a <=  14 || a >  17 && a <= 23  || a >  28 && a <=  30 || a >  33 && a <=  38 
    || a >  49 && a <=  54 || a >  61 && a <= 62  || a >  65 && a <=  69 || a >  81 && a <=  85 
    || a >  97 && a <= 101 || a > 112 && a <= 119 || a > 127 && a <= 131 || a > 142 && a <= 146 
    || a > 158 && a <= 160 || a > 174 && a <= 176 || a > 180 && a <= 181 || a > 193 && a <= 194 
    || a > 195 && a <= 196 || a > 209 && a <= 211 || a > 225 && a <= 226 || a > 236 && a <= 242 
    || a > 243 && a <= 245 || a > 249) return 0;
    
    if(a >  14 && a <=  17 || a >  30 && a <=  33 || a >  47 && a <=  49 || a >  57 && a <=  59
    || a >  60 && a <=  61 || a >  70 && a <=  71 || a >  72 && a <=  75 || a >  76 && a <=  78
    || a >  86 && a <=  87 || a >  89 && a <=  92 || a >  93 && a <=  96 || a > 103 && a <= 107 
    || a > 119 && a <= 126 || a > 161 && a <= 163 || a > 177 && a <= 180 || a > 194 && a <= 195 ) return 1;
    
    if(a >  23 && a <=  28 || a >  38 && a <=  47 || a >  62 && a <=  65 || a >  78 && a <=  81
    || a >  96 && a <=  97 || a > 111 && a <= 112 || a > 126 && a <= 127 || a > 131 && a <= 136 
    || a > 137 && a <= 140 || a > 141 && a <= 142 || a > 146 && a <= 153 || a > 154 && a <= 157 
    || a > 163 && a <= 169 || a > 183 && a <= 184 ) return 2;
    
    if(a >  54 && a <=  57 || a >  59 && a <=  60 || a >  69 && a <=  70 || a >  71 && a <=  72
    || a >  75 && a <=  76 || a >  85 && a <=  86 || a >  87 && a <=  89 || a >  92 && a <=  93
    || a > 101 && a <= 103 || a > 107 && a <= 111 || a > 160 && a <= 161 || a > 176 && a <= 177 
    || a > 191 && a <= 193 || a > 196 && a <= 197 || a > 207 && a <= 209 || a > 211 && a <= 214 
    || a > 223 && a <= 225 || a > 226 && a <= 229 || a > 242 && a <= 243 ) return 3;
    
    if(a > 136 && a <= 137 || a > 140 && a <= 141 || a > 153 && a <= 154 || a > 157 && a <= 158 
    || a > 169 && a <= 174 || a > 181 && a <= 183 || a > 184 && a <= 186 || a > 187 && a <= 189 
    || a > 190 && a <= 191 || a > 197 && a <= 207 || a > 214 && a <= 223 || a > 229 && a <= 236 
    || a > 245 && a <= 249 ) return 4;
     
    if(a > 186 && a <= 187 || a > 189 && a <= 190) return 5;
    
    return 0;
}

vec3 getColor(int palette, int pixel)
{
    if(palette == 0)return pixel == 0 ? vec3(0.0, 0.0, 0.0):
                           pixel == 1 ? vec3(1.0, 0.8, 0.8):
                           pixel == 2 ? vec3(1.0, 0.0, 0.0):
                           pixel == 3 ? vec3(0.5, 0.0, 0.0):
                           pixel == 4 ? vec3(0.0, 0.0, 1.0):
                           pixel == 5 ? vec3(1.0, 1.0, 0.0):
                                        vec3(0.0, 0.0, 0.0);
    
                    return pixel == 0 ? vec3(0.0, 0.0, 0.0):
                           pixel == 1 ? vec3(1.0, 0.8, 0.8):
                           pixel == 2 ? vec3(0.0, 1.0, 0.0):
                           pixel == 3 ? vec3(0.5, 0.0, 0.0):
                           pixel == 4 ? vec3(1.0, 1.0, 1.0):
                           pixel == 5 ? vec3(1.0, 1.0, 0.0):
                                    vec3(0.0, 0.0, 0.0);

    return vec3(0.0, 0.0, 0.0);
}

void main()
{
    float _time = time / 200.0;
    float angle = 0.0; // sin(time * 0.3) / 2.0;
    float zoom = 4.0; // (cos(time) + 2.0) * 8.0;
    float palette = fract(_time / 4.0) * 2.0;
    
    mat2 matrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));
    vec2 coord = matrix * gl_FragCoord.xy;
    //vec2 uv = coord / resolution * vec2(8.0 * zoom, 6.0 * zoom);
    vec2 uv = -1.0 + 2.0 * vUv * vec2(8.0 * zoom, 6.0 * zoom);
    uv.x = uv.x + sin(_time);
    uv.y = uv.y * abs(cos(_time));
    uv = mod( uv, vec2(16.0, 16.0 ));
    palette = cos(_time)>0.0 ? 0.0 : 1.0;
    gl_FragColor = vec4(getColor(int(palette), getPixel(int(uv.x), int(uv.y))), 1.0);
}
`,
  vertexShader:
`
varying vec2 vUv;

void main()
{
    vUv = uv;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;
}
`
});
</script>


<a-scene>
    <a-sky color="#101010"></a-sky>    
    <a-entity position="0 0 3.5">
        <a-camera></a-camera>
    </a-entity>
    <a-entity scale="2 2 2" geometry="primitive: box;" position="0 1 0" material="shader: my-custom;">
        <a-animation easing="linear" attribute="rotation" dur="10000" to="360 360 360" repeat="indefinite"></a-animation>
    </a-entity>
</a-scene>


<script type="text/javascript" src="index.js"></script>
</body>
</html>
