<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>[WebVR] A-Frame で WebVR を試してみるテスト（その５）（調整中） - js do it</title>
<meta name="Description" content="" />
<meta name="Keywords"  content="" />

<link rel="stylesheet" type="text/css" media="screen,print" href="style.css" />
</head>
<body>
<!-- generated by: jsdo.it - http://jsdo.it/cx20/syCY -->
<!-- Copyright cx20 - http://jsdo.it/cx20 -->
<!-- Licensed under MIT License - http://www.opensource.org/licenses/mit-license.php -->
<!-- aframe.js v0.8.2 -->
<script src="https://unpkg.com/aframe@0.8.2"></script>

<script type="x-shader/x-vertex" id="vs">
uniform float f1;
uniform float f2;
uniform float f3;
uniform float f4;
uniform float p1;
varying vec4 vColor;

float A1 = 50.0,                 d1 = 0.02;
float A2 = 50.0, p2 = 3.0/2.0,   d2 = 0.0315;
float A3 = 50.0, p3 = 13.0/15.0, d3 = 0.02;
float A4 = 50.0, p4 = 1.0,       d4 = 0.02;
float PI = 3.141592;

vec3 hsv(float h, float s, float v){
    vec4 t = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
    vec3 p = abs(fract(vec3(h) + t.xyz) * 6.0 - vec3(t.w));
    return v * mix(vec3(t.x), clamp(p - vec3(t.x), 0.0, 1.0), s);
}

void main()
{
    vec3 p = position;
    float t = p.x;
    float x = A1 * sin(f1 * t + PI * p1) * exp(-d1 * t) + A2 * sin(f2 * t + PI * p2) * exp(-d2 * t);
    float y = A3 * sin(f3 * t + PI * p3) * exp(-d3 * t) + A4 * sin(f4 * t + PI * p4) * exp(-d4 * t);
    float z = A1 * cos(f1 * t + PI * p1) * exp(-d1 * t) + A2 * cos(f2 * t + PI * p2) * exp(-d2 * t);
    p.x = x;
    p.y = y;
    p.z = z;

    vec4 mvPosition = modelViewMatrix * vec4( p, 1.0 );
    gl_Position = projectionMatrix * mvPosition;
    vColor = vec4(hsv(t/100.0, 1.0, 1.0), 1.0);
}
</script>

<script type="x-shader/x-fragment" id="fs">
precision mediump float;

varying vec4 vColor;

void main() {
    gl_FragColor = vColor;
}
</script>

<script>
AFRAME.registerComponent('example', {
  schema: {
  },

  init: function () {
    var data = this.data;
    var el = this.el;

    let theta = 0;
    let color;
    
    const R = 100;
    this.f1 = 0.0;
    this.f2 = 0.0;
    this.f3 = 0.0;
    this.f4 = 0.0;
    this.p1 = 0.0;
    
    this.uniforms = {
        f1:   {type: "f", value: 0.0},
        f2:   {type: "f", value: 0.0},
        f3:   {type: "f", value: 0.0},
        f4:   {type: "f", value: 0.0},
        p1:   {type: "f", value: 0.0}
    };

    this.geometry = new THREE.Geometry();
    let x, y, z;
    for (let t = 0; t <= 100; t += 0.01) {
        x = t;
        y = 0.0;
        z = 0.0;
        this.geometry.vertices.push( new THREE.Vector3( x, y, z ) );
    }

    // material
    this.material = new THREE.ShaderMaterial( {
        uniforms:       this.uniforms,
        vertexShader:   document.getElementById( 'vs' ).textContent,
        fragmentShader: document.getElementById( 'fs' ).textContent,
    });
    this.mesh = new THREE.Line(this.geometry, this.material, THREE.LineStrip);

    el.setObject3D('mesh', this.mesh);
  },
  tick: function (time, timeDelta) {
    this.f1 = (this.f1 + Math.random() / 100) % 10;
    this.f2 = (this.f2 + Math.random() / 100) % 10;
    this.f3 = (this.f3 + Math.random() / 100) % 10;
    this.f4 = (this.f4 + Math.random() / 100) % 10;
    this.p1 += (Math.PI*2 * 0.5 / 360);
    this.uniforms.f1.value = this.f1;
    this.uniforms.f2.value = this.f2;
    this.uniforms.f3.value = this.f3;
    this.uniforms.f4.value = this.f4;
    this.uniforms.p1.value = this.p1;
  }
});
</script>

<a-scene>
    <a-sky color="#101010"></a-sky>    
    <a-entity position="0 0 200">
        <a-camera></a-camera>
    </a-entity>
    <a-entity example position="0 1.5 -1">
        <a-animation easing="linear" attribute="rotation" dur="10000" to="0 360 0" repeat="indefinite"></a-animation>
    </a-entity>
</a-scene>


<script type="text/javascript" src="index.js"></script>
</body>
</html>
