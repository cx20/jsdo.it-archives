<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>[簡易版] GLSL でパーティクルの形を変えてみるテスト（その２） - js do it</title>
<meta name="Description" content="" />
<meta name="Keywords"  content="" />

<link rel="stylesheet" type="text/css" media="screen,print" href="style.css" />
</head>
<body>
<!-- generated by: jsdo.it - http://jsdo.it/cx20/kx1F -->
<!-- Copyright cx20 - http://jsdo.it/cx20 -->
<!-- Licensed under MIT License - http://www.opensource.org/licenses/mit-license.php -->
<script id="vs" type="x-shader/x-vertex">
attribute vec3 position;
uniform mat4 matPerspective;
uniform float time;
varying vec4 vColor;
varying float vTime;

void main()
{
    vec3 p = position;
    vColor = vec4(p.x+0.5, p.y+0.5, p.z/2.0+0.5, 1.0);
    vTime = time;
    
    p.z += 1.0 * mod(time * 0.1, 2.0) - 1.0;
    if ( p.z > 0.0 ) {
        p.z -= 1.0;
    }
    gl_Position = matPerspective * vec4(p, 1.0);
    
    //gl_PointSize = 1.0;
    //gl_PointSize = 0.1 * ( 1.0 / length( gl_Position.xyz ) );
    gl_PointSize = 1.0 * ( 1.0 / length( gl_Position.xyz ) );
}
</script>

<script id="fs" type="x-shader/x-fragment">
// forked from http://glslsandbox.com/e#9824.1
precision mediump float;
varying vec4 vColor;
varying vec3 vPosition;
varying float vTime;
uniform vec2  resolution; // resolution

#define MAX_ITER 10
void main( void ) {
    float time = vTime;
    vec2 center = vec2(0.5, 0.5);
    vec2 p = (gl_PointCoord.xy - center) * 5.0;
    vec2 i = p;
    float c = 0.2;
    float inten = 1.0;

    for (int n = 1; n < MAX_ITER; n++) {
        float t = time * (1.0 - (1.0 / float(n+1)));
        i = p + vec2(
            cos(t - i.x) + sin(t + i.x), 
            sin(t - i.x) + cos(t + i.y)
        );
        c += 1.0/length(vec2(
            p.x / (sin(i.x+t)/inten),
            p.y / (cos(i.y+t)/inten)
            )
        );
    }
    c /= float(MAX_ITER);
    
    vec3 col = vec3(pow(c,3.7))*vec3(0.44, 0.65, 1.53);
    if ( col.r > 0.2 || col.g > 0.2 || col.b > 0.2 ) {
        gl_FragColor = vColor * vec4( col.rgb, 1.0 );
    } else {
        discard;
    }
}
</script>

<!-- stats.js r12 -->
<script src="../../assets/o/L/t/z/oLtzH.js"></script>

<canvas id="c" width="465" height="465"></canvas>

<script type="text/javascript" src="index.js"></script>
</body>
</html>
