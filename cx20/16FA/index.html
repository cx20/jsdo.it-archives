<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>GLSL で画像にフィルタをかけてみるテスト（その７改） - js do it</title>
<meta name="Description" content="" />
<meta name="Keywords"  content="" />

<link rel="stylesheet" type="text/css" media="screen,print" href="style.css" />
</head>
<body>
<!-- generated by: jsdo.it - http://jsdo.it/cx20/16FA -->
<!-- Copyright cx20 - http://jsdo.it/cx20 -->
<!-- Licensed under MIT License - http://www.opensource.org/licenses/mit-license.php -->
<script id="fs" type="x-shader/x-fragment">
precision mediump float;

uniform sampler2D texture;
uniform float time;
uniform vec2 mouse;
uniform vec2 resolution;
varying vec4      vColor;
varying vec2      vTextureCoord;

const vec3 white = vec3(1.0, 1.0, 1.0);
const vec3 red   = vec3(1.0, 0.0, 0.0);
const vec3 green = vec3(0.0, 1.0, 0.0);
const vec3 blue  = vec3(0.0, 0.0, 1.0);

bool inCircle(vec2 position, vec2 offset, float size) {
    float len = length(position - offset);
    if (len < size) {
        return true;
    }
    return false;
}

bool inRect(vec2 position, vec2 offset, float size) {
    vec2 q = (position - offset) / size;
    if (abs(q.x) < 1.0 && abs(q.y) < 1.0) {
        return true;
    }
    return false;
}

bool inEllipse(vec2 position, vec2 offset, vec2 prop, float size) {
    vec2 q = (position - offset) / prop;
    if (length(q) < size) {
        return true;
    }
    return false;
}

void main(void) {
    vec2 uv = vTextureCoord;
    vec4 color = texture2D(texture, uv);
    vec3 destColor = color.rgb;
    vec2 position = (gl_FragCoord.xy * 2.0 - resolution) / min(resolution.x, resolution.y);

    int dataSet[16];
    dataSet[0]  = 0x0007; // 0000000000000111 
    dataSet[1]  = 0x03E7; // 0000001111100111 
    dataSet[2]  = 0x07FF; // 0000011111111111 
    dataSet[3]  = 0x07F7; // 0000011111110111 
    dataSet[4]  = 0x0FFF; // 0000111111111111 
    dataSet[5]  = 0x0FFF; // 0000111111111111 
    dataSet[6]  = 0x0FFE; // 0000111111111110 
    dataSet[7]  = 0x03FC; // 0000001111111100 
    dataSet[8]  = 0x3FF8; // 0011111111111000 
    dataSet[9]  = 0x7FF9; // 0111111111111001 
    dataSet[10] = 0xFFF9; // 1111111111111001 
    dataSet[11] = 0xEFFF; // 1110111111111111 
    dataSet[12] = 0x5FFF; // 0101111111111111 
    dataSet[13] = 0x3FFF; // 0011111111111111 
    dataSet[14] = 0x7FE0; // 0111111111100000 
    dataSet[15] = 0x4F00; // 0100111100000000 
    
    for ( int j = 0; j < 16; j++ ) {
        int n = dataSet[j];
        float b = 0.0;
        for ( int i = 0; i < 16; i++ ) {
            b = mod(float(n), 2.0);
            n = int( n / 2 );
            if ( b > 0.0 ) {
                //if (inRect(position, vec2( 0.5 - float(i)/16.0, 0.5 - float(j)/16.0 ), 1.0/32.0)) {
                if (inCircle(position, vec2( 0.5 - float(i)/16.0, 0.5 - float(j)/16.0 ), 1.0/32.0)) {
                    destColor.r += sin(position.x+time);
                    destColor.g += cos(position.y+time);
                    destColor.b += sin(position.x+time)*cos(position.y+time);
                }
            }
        }
    }

    gl_FragColor = vec4(destColor, 1.0);
}
</script>

<script id="vs" type="x-shader/x-vertex">
attribute vec3 position;
attribute vec4 color;
attribute vec2 textureCoord;
uniform   mat4 mvpMatrix;
varying   vec4 vColor;
varying   vec2 vTextureCoord;

void main(void){
	vColor        = color;
	vTextureCoord = textureCoord;
	gl_Position   = mvpMatrix * vec4(position, 1.0);
}
</script>

<canvas id="canvas"></canvas>

<script type="text/javascript" src="../../lib/minMatrix.js"></script>

<script type="text/javascript" src="index.js"></script>
</body>
</html>
