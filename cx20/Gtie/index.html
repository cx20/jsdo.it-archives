<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>[WebGL] Grimoire.js で球体にエフェクトをかけてみるテスト（その２） - js do it</title>
<meta name="Description" content="" />
<meta name="Keywords"  content="" />

<link rel="stylesheet" type="text/css" media="screen,print" href="style.css" />
</head>
<body>
<!-- generated by: jsdo.it - http://jsdo.it/cx20/Gtie -->
<!-- Copyright cx20 - http://jsdo.it/cx20 -->
<!-- Licensed under MIT License - http://www.opensource.org/licenses/mit-license.php -->
<!-- grimoire-preset-basic.js v1.10.16 -->
<script src="https://unpkg.com/grimoirejs-preset-basic@1.10.16/register/grimoire-preset-basic.js"></script>

<script type="text/sort" id="shader" typeName="newMaterial">
@Pass{
  //FS_PREC(mediump,float)
  FS_PREC(highp,float)  // iPhone だと mediump → highp にしないと正しく表示されない模様
  
  varying vec2 vTexCoord;
  #ifdef VS
    attribute vec3 position;
    attribute vec2 texCoord;
    uniform mat4 _matPVM;
    void main(){
      gl_Position = _matPVM * vec4(position,1);
      vTexCoord = texCoord;
    }
  #endif
  
  #ifdef FS
    uniform sampler2D marsTexture;
    uniform sampler2D heightMapTexture;
  
    uniform float _time;
    
    void main()
    {
        vec4 mars = texture2D(marsTexture, vTexCoord);
        vec4 heightmap = texture2D(heightMapTexture, vTexCoord);
        float time = _time / 1000.0;
        if (heightmap.r < (abs(0.40 * sin(time / 10.0)))) {
          gl_FragColor = mars + vec4(-0.2, -0.1, 0.6, 1.0);
        } else if (heightmap.r < (abs(0.55 * sin(time / 10.0)))) {
          gl_FragColor = mars + vec4(-0.2, 0.2, 0.0, 1.0);
        } else {
          gl_FragColor = mars;
        }
    }
    #endif
}
</script>
<script type="text/goml" id="canvas">
<goml width="fit" height="fit">
  <!-- <import-material typeName="newMaterial" src="index.sort"/> -->
  <scene>
    <camera class="camera" position="0,3,2" >
      <camera.components>
        <MouseCameraControl/>
      </camera.components>
    </camera>
    <mesh id="mars" geometry="sphere" position="0,0,0" material="new(newMaterial)" marsTexture="../../assets/A/j/X/S/AjXS2.jpg" heightMapTexture = "../../assets/s/i/i/9/sii9N.jpg">
    <mesh id="cloud" geometry="sphere" position="0,0,0" scale="1.01" texture="../../assets/m/d/h/b/mdhb8.png"/> <!-- cloud.png -->
      <mesh.components>
      </mesh.components>
    </mesh>
  </scene>
</goml>
</script>



<script type="text/javascript" src="index.js"></script>
</body>
</html>
