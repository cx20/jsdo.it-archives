<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>[WebGL] Grimoire.js を試してみるテスト（その３） - js do it</title>
<meta name="Description" content="" />
<meta name="Keywords"  content="" />

<link rel="stylesheet" type="text/css" media="screen,print" href="style.css" />
</head>
<body>
<!-- generated by: jsdo.it - http://jsdo.it/cx20/a1kX -->
<!-- Copyright cx20 - http://jsdo.it/cx20 -->
<!-- Licensed under MIT License - http://www.opensource.org/licenses/mit-license.php -->
<!-- grimoire-preset-basic.js v1.11.1 -->
<script src="https://unpkg.com/grimoirejs-preset-basic@1.11.1/register/grimoire-preset-basic.js"></script>

<script type="text/goml" id="canvas">
<goml width="fit" height="fit">
  <!-- <import-material typeName="lambert" src="http://jsrun.it/assets/o/X/e/h/oXehW" /> --> <!-- シェーダを外部ファイルから参照する場合の記述方法 -->
  <!-- <geometry name="cube" type="cube" /> --> <!-- geometry名「cube」は grimoire-preset-basic.js で登録済みである為、定義しなくても使用可能。-->
  <scene>
    <camera class="camera" position="0,0,5">
      <camera.components>
        <MouseCameraControl/>
      </camera.components>
    </camera>
    <mesh geometry="cube" position="0,0,0" material="new(lambert)"  color="#00f" sun="n(0,0,-1)" >
      <mesh.components>
        <Rotate/> <!-- 回転させる為のコンポーネント -->
      </mesh.components>
    </mesh>
  </scene>
</goml>
</script>


<script type="text/sort" id="shader" typeName="lambert">
@Pass{
    @DepthFunc(LEQUAL)
    @BlendFunc(SRC_ALPHA,ONE_MINUS_SRC_ALPHA)
    @CullFace(BACK)

    FS_PREC(mediump,float)

    varying vec2 vTexCoord;
    varying vec3 vNormal;

    #ifdef VS
      attribute vec3 position;
      attribute vec3 normal;
      attribute vec2 texCoord;
      uniform mat4 _matPVM;
      uniform mat4 _matM;
      void main(){
        gl_Position = _matPVM * vec4(position, 1.);
        vTexCoord = texCoord;
        vNormal = (_matM * vec4(normal, 0.)).xyz;
      }
    #endif

    #ifdef FS
      @{usedFlag:"_textureUsed"}
      uniform sampler2D texture;
      uniform bool _textureUsed;
      @{type:"color", default:"#6E183D"}
      uniform vec4 color;
      @{type:"vec3", default:"n(1,1,1)"}
      uniform vec3 sun;
      void main(){
        vec3 diffuse = max(dot(vNormal, -1. * sun), 0.3) * color.rgb;
        if (_textureUsed) {
          diffuse = diffuse * texture2D(texture, vTexCoord).rgb;
        }
        gl_FragColor = vec4(diffuse, 1.0);
      }
    #endif
}
</script>


<script type="text/javascript" src="index.js"></script>
</body>
</html>
